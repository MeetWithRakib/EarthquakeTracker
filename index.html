<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EarthquakeTracker | Real-time Earthquake Monitor</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-red: #ff0055;
            --neon-green: #39ff14;
            --neon-gold: #ffaa00;
            --bg-dark: #050505;
            --panel-bg: rgba(10, 10, 10, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
            --panel-width: 380px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-dark);
            color: #e0e0e0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- UI Components --- */
        #alarm-system {
            display: none;
            background: var(--neon-red);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            position: fixed;
            top: 0; width: 100%; z-index: 10000;
            box-shadow: 0 5px 25px rgba(255, 0, 85, 0.5);
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { background-color: #ff0055; }
            50% { background-color: #990033; }
            100% { background-color: #ff0055; }
        }

        header {
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            z-index: 2000;
        }

        header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 2px;
            color: var(--neon-blue);
            text-transform: uppercase;
        }

        #clock {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
        }

        /* --- Main Layout --- */
        #main-container {
            display: flex;
            flex: 1;
            position: relative;
        }

        #map-area { flex: 1; position: relative; }
        #map { height: 100%; width: 100%; filter: brightness(0.8) contrast(1.2); }

        /* --- Sidebar & Panels --- */
        #data-panel {
            width: var(--panel-width);
            background: var(--panel-bg);
            backdrop-filter: blur(15px);
            border-left: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2500;
        }

        .stat-box {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .stat-box h3 {
            font-size: 0.85rem;
            color: var(--neon-blue);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .loc-info {
            font-family: 'Consolas', monospace;
            font-size: 0.8rem;
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #1a1a1a;
            line-height: 1.8;
        }

        .loc-info b { color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); }

        /* --- Risk Progress Bar --- */
        .risk-container { margin-top: 10px; }
        .risk-bar {
            height: 6px;
            background: #111;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #222;
        }
        #risk-fill {
            height: 100%;
            width: 0%;
            background: var(--neon-green);
            transition: 1.5s ease;
            box-shadow: 0 0 15px var(--neon-green);
        }

        /* --- Quake Feed --- */
        #feed-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* Custom Scrollbar */
        #feed-list::-webkit-scrollbar { width: 4px; }
        #feed-list::-webkit-scrollbar-track { background: transparent; }
        #feed-list::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 10px; }

        .quake-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid var(--neon-blue);
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s;
        }

        .quake-card:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: scale(1.02);
            border-color: var(--neon-blue);
        }

        .quake-card h4 { font-size: 0.9rem; margin-bottom: 5px; color: #fff; }
        .quake-card p { font-size: 0.75rem; color: #888; }

        /* --- Map Buttons --- */
        .map-switch {
            position: absolute;
            top: 20px; right: 20px;
            z-index: 1000;
            display: flex; gap: 10px;
        }

        .map-switch button {
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            border: 1px solid var(--glass-border);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.65rem;
            transition: 0.3s;
        }

        .map-switch button.active {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 15px var(--neon-blue);
        }

       #menu-toggle {
    display: none; /* মোবাইলে দেখানোর জন্য মিডিয়া কুয়েরিতে এটি ব্লক করা আছে */
    position: fixed;
    bottom: 30px; 
    right: 30px;
    width: 60px;    /* বাটনের প্রস্থ */
    height: 60px;   /* বাটনের উচ্চতা */
    border-radius: 50%; /* বাটনটি গোল করার জন্য */
    background: var(--neon-blue); /* ব্যাকগ্রাউন্ড কালার */
    border: 2px solid var(--neon-blue);
    cursor: pointer;
    z-index: 3000;
    box-shadow: 0 0 15px var(--neon-blue);
    overflow: hidden; /* ইমেজের বাড়তি অংশ কেটে ফেলার জন্য */
    padding: 0; /* বাটনের ভেতর যেন কোনো গ্যাপ না থাকে */
}

#menu-toggle img {
    width: 100%;    /* ইমেজের প্রস্থ বাটনের সমান হবে */
    height: 100%;   /* ইমেজের উচ্চতা বাটনের সমান হবে */
    object-fit: cover; /* ইমেজটিকে স্ট্রেচ না করে সুন্দরভাবে ফিট করবে */
    display: block;
}

/* মোবাইল রেসপন্সিভনেস নিশ্চিত করতে */
@media (max-width: 768px) {
    #menu-toggle {
        display: block;
    }
}


        #close-panel {
            display: none;
            padding: 15px;
            text-align: right;
            font-size: 1.2rem;
            color: var(--neon-red);
            cursor: pointer;
        }

        @media (max-width: 768px) {
            #data-panel {
                position: fixed;
                right: 0; top: 0;
                height: 100%;
                width: 85%;
                transform: translateX(100%);
            }
            #data-panel.active { transform: translateX(0); }
            #menu-toggle, #close-panel { display: block; }
            header h1 { font-size: 0.8rem; }
        }
    </style>
</head>
<body>

    <div id="alarm-system">
        <i class="fas fa-exclamation-triangle"></i> এলার্ম: নিকটবর্তী এলাকায় শক্তিশালী ভূমিকম্প শনাক্ত!
    </div>

    <header>
        <h1><i class="fas fa-satellite-dish"></i> QuakeTracker<span style="color:#555; margin: 0 10px;">|</span></h1>
        <div id="clock">00:00:00</div>
    </header>

    <div id="main-container">
        <div id="map-area">
            <div id="map"></div>
            <div class="map-switch">
                <button id="btn-neon" class="active" onclick="changeLayer('neon')">VECTOR</button>
                <button id="btn-sat" onclick="changeLayer('sat')">SATELLITE</button>
            </div>
            <button id="menu-toggle" onclick="toggleSidebar()">
    <img src="./icon.png" alt="EarthquakeTracker">
</button>

</i></button>
        </div>

        <aside id="data-panel">
            <div id="close-panel" onclick="toggleSidebar()"><i class="fas fa-times"></i></div>
            
            <div class="stat-box">
                <h3><i class="fas fa-crosshairs"></i> Sensor Location</h3>
                <div class="loc-info">
                    LAT: <b id="lat">0.0000</b><br>
                    LON: <b id="lon">0.0000</b><br>
                    ALT: <b id="alt">0.0 m</b> | ACC: <b id="acc">0 m</b>
                </div>
            </div>

            <div class="stat-box">
                <h3><i class="fas fa-shield-virus"></i> Risk Analysis</h3>
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:8px;">
                    <span id="risk-status">SYSTEM IDLE</span>
                    <span id="risk-val" style="color:var(--neon-green)">0%</span>
                </div>
                <div class="risk-container">
                    <div class="risk-bar"><div id="risk-fill"></div></div>
                </div>
            </div>

            <div id="feed-list">
                <div style="text-align:center; padding:40px; color:#444;">
                    <i class="fas fa-spinner fa-spin" style="font-size:2rem; margin-bottom:10px;"></i>
                    <p>Scanning Global Feeds...</p>
                </div>
            </div>
        </aside>
    </div>

    <audio id="alarm-audio" src="./sound.wav" loop></audio>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map, neonLayer, satLayer;
        let uLat = 0, uLon = 0;
        let markers = [];

        function init() {
            // Initialize Map
            map = L.map('map', { 
                zoomControl: false,
                attributionControl: false 
            }).setView([23.8103, 90.4125], 3); // Centered on Dhaka initially

            neonLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
            satLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}');

            // Clock
            setInterval(() => {
                document.getElementById('clock').innerText = new Date().toLocaleTimeString();
            }, 1000);

            // Geolocation
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(p => {
                    uLat = p.coords.latitude;
                    uLon = p.coords.longitude;
                    document.getElementById('lat').innerText = uLat.toFixed(4);
                    document.getElementById('lon').innerText = uLon.toFixed(4);
                    document.getElementById('alt').innerText = (p.coords.altitude || 0).toFixed(1) + " m";
                    document.getElementById('acc').innerText = p.coords.accuracy.toFixed(0) + " m";
                    
                    L.circleMarker([uLat, uLon], { 
                        radius: 10, 
                        color: '#00f3ff', 
                        fillColor: '#00f3ff', 
                        fillOpacity: 0.5,
                        className: 'user-marker'
                    }).addTo(map);
                }, null, { enableHighAccuracy: true });
            }

            fetchQuakeData();
            setInterval(fetchQuakeData, 60000); // 1 minute refresh
        }

        function toggleSidebar() {
            document.getElementById('data-panel').classList.toggle('active');
        }

        function changeLayer(type) {
            if(type === 'sat') {
                map.addLayer(satLayer);
                map.removeLayer(neonLayer);
                document.getElementById('btn-sat').className = 'active';
                document.getElementById('btn-neon').className = '';
            } else {
                map.addLayer(neonLayer);
                map.removeLayer(satLayer);
                document.getElementById('btn-neon').className = 'active';
                document.getElementById('btn-sat').className = '';
            }
        }

        async function fetchQuakeData() {
            try {
                const res = await fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson');
                const data = await res.json();
                processQuakes(data.features);
            } catch (e) {
                console.error("Data fetch error");
            }
        }

        function processQuakes(quakes) {
            const feed = document.getElementById('feed-list');
            feed.innerHTML = "";
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            let highestRisk = 0;
            let alarmTriggered = false;

            quakes.sort((a, b) => b.properties.mag - a.properties.mag);

            quakes.forEach(q => {
                const [lon, lat] = q.geometry.coordinates;
                const mag = q.properties.mag;
                const place = q.properties.place;
                const time = new Date(q.properties.time).toLocaleTimeString();
                const dist = getDistance(uLat, uLon, lat, lon);

                // Alarm Logic
                if (dist < 500 && mag > 4.5) alarmTriggered = true;
                
                // Risk Calculation
                if (dist < 1500) {
                    let riskIndex = (mag * (1 - dist/1500));
                    if (riskIndex > highestRisk) highestRisk = riskIndex;
                }

                // UI Decoration
                let color = mag > 6 ? '#ff0055' : mag > 4.5 ? '#ffaa00' : '#39ff14';
                
                // Add Marker
                let marker = L.circle([lat, lon], { 
                    radius: mag * 20000, 
                    color: color, 
                    weight: 2, 
                    fillOpacity: 0.15 
                }).addTo(map);
                
                marker.bindPopup(`<div style="font-family:Rajdhani; background:#000; color:#fff; border:1px solid ${color}; padding:10px; border-radius:5px;">
                    <b style="color:${color}">Magnitude: ${mag}</b><br>
                    ${place}<br>
                    Distance: ${dist.toFixed(0)} km
                </div>`);
                markers.push(marker);

                // Create Card
                const card = document.createElement('div');
                card.className = `quake-card`;
                card.style.borderLeftColor = color;
                card.innerHTML = `
                    <span style="float:right; color:${color}; font-weight:bold; font-family:Orbitron;">M ${mag.toFixed(1)}</span>
                    <h4>${place}</h4>
                    <p><i class="far fa-clock"></i> ${time} | <i class="fas fa-map-marker-alt"></i> ${dist.toFixed(0)} km away</p>
                `;
                
                card.onclick = () => {
                    map.setView([lat, lon], 6);
                    marker.openPopup();
                    if(window.innerWidth <= 768) toggleSidebar();
                };
                feed.appendChild(card);
            });

            updateUI(highestRisk, alarmTriggered);
        }

        function updateUI(risk, alarm) {
            const fill = document.getElementById('risk-fill');
            const status = document.getElementById('risk-status');
            const valText = document.getElementById('risk-val');
            const alarmBanner = document.getElementById('alarm-system');
            const audio = document.getElementById('alarm-audio');

            let pct = Math.min(risk * 18, 100);
            fill.style.width = pct + "%";
            valText.innerText = pct.toFixed(0) + "%";

            if (pct > 75) {
                fill.style.background = 'var(--neon-red)';
                status.innerText = "EXTREME DANGER";
                status.style.color = 'var(--neon-red)';
            } else if (pct > 40) {
                fill.style.background = 'var(--neon-gold)';
                status.innerText = "WARNING: HIGH RISK";
                status.style.color = 'var(--neon-gold)';
            } else {
                fill.style.background = 'var(--neon-green)';
                status.innerText = "STATUS: NOMINAL";
                status.style.color = 'var(--neon-green)';
            }

            if (alarm) {
                alarmBanner.style.display = 'block';
                audio.play().catch(() => {});
            } else {
                alarmBanner.style.display = 'none';
                audio.pause();
            }
        }

        function getDistance(la1, lo1, la2, lo2) {
            const R = 6371;
            const dLat = (la2-la1)*Math.PI/180;
            const dLon = (lo2-lo1)*Math.PI/180;
            const a = Math.sin(dLat/2)**2 + Math.cos(la1*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLon/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        window.onload = init;
    </script>
</body>
</html>
